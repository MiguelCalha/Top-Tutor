{
  "version": 3,
  "sources": ["../../../../src/lib/editor/managers/TickManager.ts"],
  "sourcesContent": ["import { Vec } from '../../primitives/Vec'\nimport { Editor } from '../Editor'\n\nexport class TickManager {\n\tconstructor(public editor: Editor) {\n\t\tthis.editor.disposables.add(this.dispose)\n\t\tthis.start()\n\t}\n\n\traf: any\n\tisPaused = true\n\tlast = 0\n\tt = 0\n\n\tstart = () => {\n\t\tthis.isPaused = false\n\t\tcancelAnimationFrame(this.raf)\n\t\tthis.raf = requestAnimationFrame(this.tick)\n\t\tthis.last = Date.now()\n\t}\n\n\ttick = () => {\n\t\tif (this.isPaused) {\n\t\t\treturn\n\t\t}\n\n\t\tconst now = Date.now()\n\t\tconst elapsed = now - this.last\n\t\tthis.last = now\n\t\tthis.t += elapsed\n\n\t\tthis.editor.emit('frame', elapsed)\n\n\t\tif (this.t < 16) {\n\t\t\tthis.raf = requestAnimationFrame(this.tick)\n\t\t\treturn\n\t\t}\n\n\t\tthis.t -= 16\n\t\tthis.updatePointerVelocity(elapsed)\n\t\tthis.editor.emit('tick', elapsed)\n\t\tthis.raf = requestAnimationFrame(this.tick)\n\t}\n\n\t// Clear the listener\n\tdispose = () => {\n\t\tthis.isPaused = true\n\t\tcancelAnimationFrame(this.raf)\n\t}\n\n\tprivate prevPoint = new Vec()\n\n\tprivate updatePointerVelocity = (elapsed: number) => {\n\t\tconst {\n\t\t\tprevPoint,\n\t\t\teditor: {\n\t\t\t\tinputs: { currentScreenPoint, pointerVelocity },\n\t\t\t},\n\t\t} = this\n\n\t\tif (elapsed === 0) return\n\n\t\tconst delta = Vec.Sub(currentScreenPoint, prevPoint)\n\t\tthis.prevPoint = currentScreenPoint.clone()\n\n\t\tconst length = delta.len()\n\t\tconst direction = length ? delta.div(length) : new Vec(0, 0)\n\n\t\t// consider adjusting this with an easing rather than a linear interpolation\n\t\tconst next = pointerVelocity.clone().lrp(direction.mul(length / elapsed), 0.5)\n\n\t\t// if the velocity is very small, just set it to 0\n\t\tif (Math.abs(next.x) < 0.01) next.x = 0\n\t\tif (Math.abs(next.y) < 0.01) next.y = 0\n\n\t\tif (!pointerVelocity.equals(next)) {\n\t\t\tthis.editor.inputs.pointerVelocity = next\n\t\t}\n\t}\n}\n"],
  "mappings": "AAAA,SAAS,WAAW;AAGb,MAAM,YAAY;AAAA,EACxB,YAAmB,QAAgB;AAAhB;AAClB,SAAK,OAAO,YAAY,IAAI,KAAK,OAAO;AACxC,SAAK,MAAM;AAAA,EACZ;AAAA,EAEA;AAAA,EACA,WAAW;AAAA,EACX,OAAO;AAAA,EACP,IAAI;AAAA,EAEJ,QAAQ,MAAM;AACb,SAAK,WAAW;AAChB,yBAAqB,KAAK,GAAG;AAC7B,SAAK,MAAM,sBAAsB,KAAK,IAAI;AAC1C,SAAK,OAAO,KAAK,IAAI;AAAA,EACtB;AAAA,EAEA,OAAO,MAAM;AACZ,QAAI,KAAK,UAAU;AAClB;AAAA,IACD;AAEA,UAAM,MAAM,KAAK,IAAI;AACrB,UAAM,UAAU,MAAM,KAAK;AAC3B,SAAK,OAAO;AACZ,SAAK,KAAK;AAEV,SAAK,OAAO,KAAK,SAAS,OAAO;AAEjC,QAAI,KAAK,IAAI,IAAI;AAChB,WAAK,MAAM,sBAAsB,KAAK,IAAI;AAC1C;AAAA,IACD;AAEA,SAAK,KAAK;AACV,SAAK,sBAAsB,OAAO;AAClC,SAAK,OAAO,KAAK,QAAQ,OAAO;AAChC,SAAK,MAAM,sBAAsB,KAAK,IAAI;AAAA,EAC3C;AAAA;AAAA,EAGA,UAAU,MAAM;AACf,SAAK,WAAW;AAChB,yBAAqB,KAAK,GAAG;AAAA,EAC9B;AAAA,EAEQ,YAAY,IAAI,IAAI;AAAA,EAEpB,wBAAwB,CAAC,YAAoB;AACpD,UAAM;AAAA,MACL;AAAA,MACA,QAAQ;AAAA,QACP,QAAQ,EAAE,oBAAoB,gBAAgB;AAAA,MAC/C;AAAA,IACD,IAAI;AAEJ,QAAI,YAAY;AAAG;AAEnB,UAAM,QAAQ,IAAI,IAAI,oBAAoB,SAAS;AACnD,SAAK,YAAY,mBAAmB,MAAM;AAE1C,UAAM,SAAS,MAAM,IAAI;AACzB,UAAM,YAAY,SAAS,MAAM,IAAI,MAAM,IAAI,IAAI,IAAI,GAAG,CAAC;AAG3D,UAAM,OAAO,gBAAgB,MAAM,EAAE,IAAI,UAAU,IAAI,SAAS,OAAO,GAAG,GAAG;AAG7E,QAAI,KAAK,IAAI,KAAK,CAAC,IAAI;AAAM,WAAK,IAAI;AACtC,QAAI,KAAK,IAAI,KAAK,CAAC,IAAI;AAAM,WAAK,IAAI;AAEtC,QAAI,CAAC,gBAAgB,OAAO,IAAI,GAAG;AAClC,WAAK,OAAO,OAAO,kBAAkB;AAAA,IACtC;AAAA,EACD;AACD;",
  "names": []
}
