{
  "version": 3,
  "sources": ["../../src/shapes/TLArrowShape.ts"],
  "sourcesContent": ["import { defineMigrations } from '@tldraw/store'\nimport { T } from '@tldraw/validate'\nimport { vecModelValidator } from '../misc/geometry-types'\nimport { StyleProp } from '../styles/StyleProp'\nimport { DefaultColorStyle, DefaultLabelColorStyle } from '../styles/TLColorStyle'\nimport { DefaultDashStyle } from '../styles/TLDashStyle'\nimport { DefaultFillStyle } from '../styles/TLFillStyle'\nimport { DefaultFontStyle } from '../styles/TLFontStyle'\nimport { DefaultSizeStyle } from '../styles/TLSizeStyle'\nimport { ShapePropsType, TLBaseShape, shapeIdValidator } from './TLBaseShape'\n\nconst arrowheadTypes = [\n\t'arrow',\n\t'triangle',\n\t'square',\n\t'dot',\n\t'pipe',\n\t'diamond',\n\t'inverted',\n\t'bar',\n\t'none',\n] as const\n\n/** @public */\nexport const ArrowShapeArrowheadStartStyle = StyleProp.defineEnum('tldraw:arrowheadStart', {\n\tdefaultValue: 'none',\n\tvalues: arrowheadTypes,\n})\n\n/** @public */\nexport const ArrowShapeArrowheadEndStyle = StyleProp.defineEnum('tldraw:arrowheadEnd', {\n\tdefaultValue: 'arrow',\n\tvalues: arrowheadTypes,\n})\n\n/** @public */\nexport type TLArrowShapeArrowheadStyle = T.TypeOf<typeof ArrowShapeArrowheadStartStyle>\n\n/** @public */\nconst ArrowShapeTerminal = T.union('type', {\n\tbinding: T.object({\n\t\ttype: T.literal('binding'),\n\t\tboundShapeId: shapeIdValidator,\n\t\tnormalizedAnchor: vecModelValidator,\n\t\tisExact: T.boolean,\n\t\tisPrecise: T.boolean,\n\t}),\n\tpoint: T.object({\n\t\ttype: T.literal('point'),\n\t\tx: T.number,\n\t\ty: T.number,\n\t}),\n})\n\n/** @public */\nexport type TLArrowShapeTerminal = T.TypeOf<typeof ArrowShapeTerminal>\n\n/** @public */\nexport const arrowShapeProps = {\n\tlabelColor: DefaultLabelColorStyle,\n\tcolor: DefaultColorStyle,\n\tfill: DefaultFillStyle,\n\tdash: DefaultDashStyle,\n\tsize: DefaultSizeStyle,\n\tarrowheadStart: ArrowShapeArrowheadStartStyle,\n\tarrowheadEnd: ArrowShapeArrowheadEndStyle,\n\tfont: DefaultFontStyle,\n\tstart: ArrowShapeTerminal,\n\tend: ArrowShapeTerminal,\n\tbend: T.number,\n\ttext: T.string,\n\tlabelPosition: T.number,\n}\n\n/** @public */\nexport type TLArrowShapeProps = ShapePropsType<typeof arrowShapeProps>\n\n/** @public */\nexport type TLArrowShape = TLBaseShape<'arrow', TLArrowShapeProps>\n\nexport const ArrowMigrationVersions = {\n\tAddLabelColor: 1,\n\tAddIsPrecise: 2,\n\tAddLabelPosition: 3,\n} as const\n\n/** @internal */\nexport const arrowShapeMigrations = defineMigrations({\n\tcurrentVersion: ArrowMigrationVersions.AddLabelPosition,\n\tmigrators: {\n\t\t[ArrowMigrationVersions.AddLabelColor]: {\n\t\t\tup: (record) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...record.props,\n\t\t\t\t\t\tlabelColor: 'black',\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (record) => {\n\t\t\t\tconst { labelColor: _, ...props } = record.props\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tprops,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\t\t[ArrowMigrationVersions.AddIsPrecise]: {\n\t\t\tup: (record) => {\n\t\t\t\tconst { start, end } = record.props\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...record.props,\n\t\t\t\t\t\tstart:\n\t\t\t\t\t\t\t(start as TLArrowShapeTerminal).type === 'binding'\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t...start,\n\t\t\t\t\t\t\t\t\t\tisPrecise: !(\n\t\t\t\t\t\t\t\t\t\t\tstart.normalizedAnchor.x === 0.5 && start.normalizedAnchor.y === 0.5\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: start,\n\t\t\t\t\t\tend:\n\t\t\t\t\t\t\t(end as TLArrowShapeTerminal).type === 'binding'\n\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t...end,\n\t\t\t\t\t\t\t\t\t\tisPrecise: !(end.normalizedAnchor.x === 0.5 && end.normalizedAnchor.y === 0.5),\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t: end,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (record: any) => {\n\t\t\t\tconst { start, end } = record.props\n\t\t\t\tconst nStart = { ...start }\n\t\t\t\tconst nEnd = { ...end }\n\t\t\t\tif (nStart.type === 'binding') {\n\t\t\t\t\tif (!nStart.isPrecise) {\n\t\t\t\t\t\tnStart.normalizedAnchor = { x: 0.5, y: 0.5 }\n\t\t\t\t\t}\n\t\t\t\t\tdelete nStart.isPrecise\n\t\t\t\t}\n\t\t\t\tif (nEnd.type === 'binding') {\n\t\t\t\t\tif (!nEnd.isPrecise) {\n\t\t\t\t\t\tnEnd.normalizedAnchor = { x: 0.5, y: 0.5 }\n\t\t\t\t\t}\n\t\t\t\t\tdelete nEnd.isPrecise\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...record.props,\n\t\t\t\t\t\tstart: nStart,\n\t\t\t\t\t\tend: nEnd,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\t\t[ArrowMigrationVersions.AddLabelPosition]: {\n\t\t\tup: (record) => {\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tprops: {\n\t\t\t\t\t\t...record.props,\n\t\t\t\t\t\tlabelPosition: 0.5,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t\tdown: (record) => {\n\t\t\t\tconst { labelPosition: _, ...props } = record.props\n\t\t\t\treturn {\n\t\t\t\t\t...record,\n\t\t\t\t\tprops,\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t},\n})\n"],
  "mappings": "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",
  "names": []
}
